# OpenOCD configuration for cJTAG (OScan1) mode testing
# Usage: openocd -f openocd/cjtag.cfg

# VPI adapter configuration
adapter driver jtag_vpi
jtag_vpi set_port 3333
jtag_vpi set_address 127.0.0.1

# Transport selection (must be after adapter driver)
transport select jtag

# Adapter speed (kHz) - cJTAG can run at higher speeds
adapter speed 2000

# GDB server port (separate from VPI port 3333)
gdb port 3334

# cJTAG specific settings (if supported by OpenOCD version)
# Note: Standard OpenOCD may require custom patches for full cJTAG support
# This config assumes the VPI server handles cJTAG protocol translation

# Define the TAP
# -irlen: Instruction register length (8 bits)
# -expected-id: Expected IDCODE value (same as JTAG mode)
jtag newtap riscv cpu -irlen 8 -expected-id 0x1dead3ff

# Create target
set _TARGETNAME riscv.cpu
target create $_TARGETNAME riscv -chain-position $_TARGETNAME

# RISC-V specific configuration
riscv set_mem_access progbuf sysbus abstract
riscv set_command_timeout_sec 10

# Initialize
init

echo "OpenOCD initialized in cJTAG mode"
echo "Note: Ensure simulation is started with mode_select=1 (cJTAG mode)"
echo "IDCODE: 0x1dead3ff"
echo "Connect via: telnet localhost 4444"
