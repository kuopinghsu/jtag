# OpenOCD Configuration with cJTAG/OScan1 Support
# Simplified version with only supported commands

# VPI Adapter Configuration
adapter driver jtag_vpi
jtag_vpi set_port 3333

# Avoid port clash with VPI server
gdb_port 3334

# Enable cJTAG/OScan1 two-wire mode
jtag_vpi enable_cjtag on

# Transport and Target Configuration
transport select jtag
adapter speed 1000
reset_config none

# Define JTAG TAP for RISC-V target
jtag newtap riscv cpu -irlen 5 -expected-id 0x1dead3ff

# Create RISC-V target
target create riscv.cpu riscv -chain-position riscv.cpu

# Configure RISC-V Debug Module Interface (DMI)
riscv set_ir dtmcs 0x10
riscv set_ir dmi 0x11
riscv set_mem_access abstract
riscv set_command_timeout_sec 10

# Initialize
init

echo "=================================================="
echo "OpenOCD cJTAG/OScan1 Configuration Loaded"
echo "=================================================="
echo "Mode:            cJTAG"
echo "Adapter:         jtag_vpi (port 3333)"
echo "GDB Port:        3334"

# Verify connection
scan_chain
